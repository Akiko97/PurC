# test cases for $SQLITE

# $SQLITE.impl and $SQLITE.info
positive:
    $SQLITE.impl.vendor
    'HVML Community'

positive:
    $SQLITE.impl.author
    'Nine Xue'

positive:
    $SQLITE.impl.license
    'LGPLv3+'

positive:
    $SQLITE.impl.url
    'https://hvml.fmsoft.cn'

positive:
    $SQLITE.impl.repo
    'https://github.com/HVML'


# \$SQLITE.connect memory
positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect(':memory:'))
    true

positive:
    $RUNNER.myObj.sqliteConn.close()
    true

# \$SQLITE.connect  path
positive:
    $RUNNER.user(! 'sqliteConn', undefined )
    true

positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect('/tmp/test_extdvobj_sqlite.db'))
    true

positive:
    $RUNNER.myObj.sqliteConn.close()
    true

positive:
    $RUNNER.user(! 'sqliteConn', undefined )
    true

positive:
    $FS.unlink('/tmp/test_extdvobj_sqlite.db')
    true

# \$SQLITE.connect  URI
positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect('file:///tmp/test_extdvobj_sqlite_uri.db'))
    true

positive:
    $RUNNER.myObj.sqliteConn.close()
    true

positive:
    $RUNNER.user(! 'sqliteConn', undefined )
    true

positive:
    $FS.unlink('/tmp/test_extdvobj_sqlite_uri.db')
    true

negative:
    $SQLITE.connect
    ArgumentMissed

negative:
    $SQLITE.connect(1)
    WrongDataType

negative:
    $SQLITE.connect(true)
    WrongDataType

negative:
    $SQLITE.connect({})
    WrongDataType

negative:
    $SQLITE.connect([])
    WrongDataType

negative:
    $SQLITE.connect(2.0)
    WrongDataType

negative:
    $SQLITE.connect('')
    InvalidValue

# \$SQLiteConn.cursor
positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect(':memory:'))
    true

positive:
    $RUNNER.user(! 'sqliteCursor', $RUNNER.myObj.sqliteConn.cursor())
    true

positive:
    $RUNNER.myObj.sqliteConn.commit()
    true

positive:
    $RUNNER.myObj.sqliteConn.rollback()
    true

positive:
    $RUNNER.myObj.sqliteCursor.close()
    true

positive:
    $RUNNER.myObj.sqliteConn.close()
    true

positive:
    $RUNNER.user(! 'sqliteCursor', undefined )
    true

positive:
    $RUNNER.user(! 'sqliteConn', undefined )
    true

# \$SQLiteConnect.execute/executemany
positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect('/tmp/test_extdvobj_sqlite_conn_exec.db'))
    true

positive:
    $RUNNER.user(! 'sqliteCursor', $RUNNER.myObj.sqliteConn.execute('CREATE TABLE "user" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" TEXT not null, "age" integer DEFAULT 0, "createdAt" integer DEFAULT 0, "expiredAt" TEXT);'))
    true

positive:
    $RUNNER.user(! 'sqliteCursor', $RUNNER.myObj.sqliteConn.execute('insert into user(name, age, createdAt, expiredAt) values (?, ?, ?, ?);', ['zhang san', 15L, 1703499183L, '2024-12-25 18:13:03']))
    true

positive:
    $RUNNER.user(! 'sqliteCursor', $RUNNER.myObj.sqliteConn.executemany('insert into user(name, age, createdAt, expiredAt) values (?, ?, ?, ?);', [['li si', 16L, 1703499183L, '2024-12-25 18:13:03'], ['wang wu', 17L, 1703499183L, '2024-12-25 18:13:03']]))
    true

positive:
    $RUNNER.myObj.sqliteConn.commit()
    true

positive:
    $FS.unlink('/tmp/test_extdvobj_sqlite_conn_exec.db')
    true

# \$SQLiteCursor
positive:
    $RUNNER.user(! 'sqliteConn', $SQLITE.connect('/tmp/test_extdvobj_sqlite.db'))
    true

positive:
    $RUNNER.user(! 'sqliteCursor', $RUNNER.myObj.sqliteConn.cursor())
    true

positive:
    $RUNNER.myObj.sqliteCursor.execute('CREATE TABLE "user" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "name" TEXT not null, "age" integer DEFAULT 0, "createdAt" integer DEFAULT 0, "expiredAt" TEXT);')
    true

positive:
    $RUNNER.myObj.sqliteCursor.execute('insert into user(name, age, createdAt, expiredAt) values (?, ?, ?, ?);', ['zhang san', 15L, 1703499183L, '2024-12-25 18:13:03'])
    true

positive:
    $RUNNER.myObj.sqliteCursor.executemany('insert into user(name, age, createdAt, expiredAt) values (?, ?, ?, ?);', [['li si', 16L, 1703499183L, '2024-12-25 18:13:03'], ['wang wu', 17L, 1703499183L, '2024-12-25 18:13:03']])
    true

positive:
    $RUNNER.myObj.sqliteConn.commit()
    true

positive:
    $RUNNER.myObj.sqliteCursor.close()
    true

positive:
    $RUNNER.myObj.sqliteConn.close()
    true

positive:
    $RUNNER.user(! 'sqliteConn', undefined )
    true

positive:
    $FS.unlink('/tmp/test_extdvobj_sqlite.db')
    true

