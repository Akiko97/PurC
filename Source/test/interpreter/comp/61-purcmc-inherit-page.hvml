#!/usr/bin/purc

# RESULT: '<html><head></head><body id="theChild"><ul id="theList"><li>main</li><li>child</li></ul></body></html>'

<hvml target="html">
    <body>
        <ul id='theList'>
        </ul>

        <!-- observe on $CRTN for 'rdrState:pageLoaded'>
            <load from "#theChild" onto 'inherit:' as 'childCrtn' async />

            <observe on $childCrtn for 'corState:exited' >
                <inherit>
                    $STREAM.stdout.writelines("got corState:exited");
                </inherit>
                <exit with $DOC.serialize />
            </observe>
        </observe -->

        <load from "#theChild" onto 'inherit:' as 'childCrtn' async />

        <update on '#theList' to 'append' with '<li>main</li>' />

        <observe on $childCrtn for 'corState:exited' >
            <inherit>
                $STREAM.stdout.writelines("got corState:exited; The number of requests sent: $RDR.stats.nrRequestsSent");
            </inherit>

            <exit with $DOC.serialize />
        </observe>

        <observe on $CRTN for 'rdrState:pageReloaded' >
            <exit with 'bad' />
        </observe>

    </body>

    <body id="theChild">
        <sleep for '1s' />
        <observe on $CRTN for 'idle'>
            <update on '#theList' to 'append' with '<li>child</li>' />
            <exit with true />
        </observe>
    </body>
</hvml>

